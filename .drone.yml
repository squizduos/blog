pipeline:
  build:
    image: squizduos/hugo-alpine:latest
    commands:
     - hugo check
     - hugo -d ../public -s ./src
    when:
      branch: [ master ]
  deploy:
    image: plugins/docker
    registry: ${DOCKER_REGISTRY}
    repo: ${DOCKER_REGISTRY}/squizduos/squizduos.com
    tags: latest
    secrets: [ docker_registry, docker_username, docker_password ]
    when:
      branch: [ master ]
  telegram:
    image: appleboy/drone-telegram
    token: ${TELEGRAM_TOKEN}
    to: ${TELEGRAM_RECIPIENT}
    message: Сборка `squizduos/squizduos.com` завершена.
    secrets: [ telegram_token, telegram_recipient ]
    when:
      branch: [ master ]
